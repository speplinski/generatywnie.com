# Plan: Server-Side Translation System

## Architecture

Node.js + Express on GCP Cloud Run. English is source language at `/en/`.
Root `/` auto-redirects based on `Accept-Language` header.
New languages added by running `node scripts/translate.js <lang-code>`.
Translations cached as JSON files — Claude API called ONCE per language, zero API calls at runtime.

## URL Structure

```
/         → 301 redirect to /{detected-lang}/ (fallback: /en/)
/en/      → English (source)
/pl/      → Polish (when generated)
/de/      → German (when generated)
/{lang}/llms.txt → per-language LLM summary
/sitemap.xml     → dynamic, all languages with hreflang
/robots.txt      → static
```

## File Structure

```
Generatywnie.com/
├── server.js                  # Express app (~80 lines)
├── package.json
├── Dockerfile
├── .dockerignore
├── scripts/
│   └── translate.js           # Claude API translation generator
├── locales/
│   └── en.json                # English strings (source of truth)
│   └── pl.json                # (generated by translate script)
├── templates/
│   └── page.ejs               # Single EJS template (current index.html with placeholders)
│   └── llms.ejs               # LLM summary template
├── public/
│   └── (empty for now, future static assets)
├── robots.txt
├── README.md
├── llms.txt                   # (kept for backwards compat, but served dynamically)
├── sitemap.xml                # (kept for backwards compat, but served dynamically)
└── index.html                 # (kept as reference / v1 tag, not served by Express)
```

## Implementation Steps

### 1. Extract English strings → `locales/en.json`
~50 keys: meta tags, JSON-LD fields, section titles, paragraphs, blockquotes.
Inline HTML (`<strong>`, `<cite>`) stays in the values — EJS renders with `<%- %>`.

### 2. Convert `index.html` → `templates/page.ejs`
Replace hardcoded text with `<%- t('key') %>` calls.
Keep ALL CSS inline, ALL JS inline (generative seed + reveal script).
Add hreflang `<link>` tags dynamically.
Set `<html lang="<%= lang %>">`, canonical per-language.

### 3. Build `server.js`
- Express app, port from `process.env.PORT || 8080`
- Language middleware: URL path → Accept-Language header → fallback `en`
- `GET /` → 301 redirect to `/{lang}/`
- `GET /:lang/` → render `page.ejs` with translations
- `GET /:lang/llms.txt` → render `llms.ejs`
- `GET /sitemap.xml` → dynamic XML with all available languages + hreflang
- `GET /robots.txt` → static file
- Cache headers: HTML 1h public, static 1y immutable

### 4. Build `scripts/translate.js`
- Reads `locales/en.json` as source
- Calls Claude API (claude-sonnet-4-5-20250929 — fast + cheap for translation)
- Prompt: translate manifesto content, preserve `<strong>`/`<cite>` HTML, DON'T translate author names / book titles / "Generatywnie"
- Validates output JSON has all keys from en.json
- Saves to `locales/{lang}.json`
- Usage: `ANTHROPIC_API_KEY=sk-... node scripts/translate.js pl`

### 5. `Dockerfile` + `package.json`
- Node 20 Alpine
- Only production deps: `express`, `ejs`
- Dev dep: `@anthropic-ai/sdk` (translate script only)
- Port 8080

### 6. SEO
- `<link rel="alternate" hreflang="...">` for every available language
- `<link rel="alternate" hreflang="x-default">` → `/en/`
- Canonical URL per-language: `https://generatywnie.com/{lang}/`
- `og:locale` tag
- JSON-LD `inLanguage` set per-language
- Sitemap with `xhtml:link` hreflang cross-references

## What stays identical across languages
- Generative seed script (palettes, fonts, parametrics)
- All CSS
- Reveal/intersection observer script
- Section numbers (01–06)
- Author name: "Szymon P. Pepliński"
- Citation authors & book titles
- HTML structure, classes, IDs

## Cost
- Translation: ~2K input + ~2K output tokens per language ≈ $0.02/language (Sonnet)
- Runtime: zero API calls, just Express serving cached JSON
- Cloud Run: minimal, scales to zero when idle
